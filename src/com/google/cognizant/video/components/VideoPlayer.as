package com.google.cognizant.video.components {	import com.google.cognizant.video.data.PlayerSettings;	import com.google.cognizant.video.data.VideoData;	import com.google.ads.studio.utils.StudioClassAccessor;	import com.google.cognizant.video.data.VideoEventData;		import flash.display.DisplayObject;	import flash.display.Sprite;	import flash.events.Event;	import com.google.cognizant.video.events.CustomVideoEvent;		/**	 * ...	 * 	 * @author ...	 * 	 * @created mm/dd/yyyy 00:00 AM	 */	public class VideoPlayer extends Sprite {				// NOTE: This should be the order of access modifiers per section.		// - PUBLIC		// - INTERNAL		// - PROTECTED		// - PRIVATE				// Please use these section dividers as the guide limit length of chars per line.		// ------------------------------- STATIC VARIABLES --------------------------------		private static var _collection:Array = []; // VideoPlayer on stage		private static var _handlers:Array = [];		private static var _currentVideo:VideoPlayer;				// ----------------------------------- VARIABLES -----------------------------------		private var _settings:PlayerSettings;		private var _handler:Function;		private var _hasAllStudioEventListeners:Boolean;		private var _autoDestroy:Boolean;		private var _componentInstance:Object;						// --------------=--------------- STATIC GETTERS/SETTERS ---------------------------				// --------------------------- OVERRIDEN GETTERS/SETTERS ---------------------------				// ------------------------------- GETTERS/SETTERS ---------------------------------		public function get id ():String { return _settings.id; }		public function get componentInstance ():Object { return _componentInstance }		public function get currentController ():Object { return _componentInstance.getCurrentVideoController(); }				// ------------------------------- STATIC METHODS ----------------------------------		public static function addAllEventListeners (handler:Function):void {			_handlers.push(handler);		}				public static function removeAllEventListeners (handler:Function):void {			_handlers.length = 0;		}				public static function dispatchEvent (e:CustomVideoEvent):void {			var i:int = _handlers.length;			while (i--)				_handlers[i](e);		}				public static function getCurrentVideoController ():Object {			return getCurrentVideo().currentController;		}				public static function getCurrentVideo ():VideoPlayer {			return _currentVideo;		}				public static function getVideo (id:String):VideoPlayer {			for each (var vid:VideoPlayer in _collection)				if (vid.id == id) return vid;			return null;		}				public static function pauseAll ():void {			for each (var vid:VideoPlayer in _collection)				vid.pause();		}				public static function muteAll ():void {			for each (var vid:VideoPlayer in _collection)				vid.mute();		}				public function destroyAll ():void {			for each (var vid:VideoPlayer in _collection)				vid.destroy();		}				// -------------------------------- CONSTRUCTOR ------------------------------------				public function VideoPlayer () {			// constructor code			if (stage) addedToStageHandler(null);			else addEventListener(Event.ADDED_TO_STAGE, addedToStageHandler);		}								// ----------------------------- OVERRIDEN METHODS ---------------------------------		override public function dispatchEvent (e:Event):void {			VideoPlayer.dispatchEvent(CustomVideoEvent(e));			super.dispatchEvent(e);		}				// ------------------------   OVERRIDEN EVENT HANDLERS -----------------------------				// ---------------------------------  METHODS --------------------------------------				public function init (settings:PlayerSettings):void {			trace(settings);			if (!settings.componentInstance) { // Create new component instance				var videoPlayerAdvanced:Class = StudioClassAccessor.getClass('com.google.ads.studio.video.VideoPlayerAdvanced');				_componentInstance = new videoPlayerAdvanced();							} else { // Use existing component instance				_componentInstance = settings.componentInstance;							}						if (settings.dimension) {				componentInstance.x = settings.dimension.x;				componentInstance.y = settings.dimension.y;				componentInstance.width = settings.dimension.width;				componentInstance.height = settings.dimension.height;			}						componentInstance.videoSmoothing = true;						var progressive:Array = settings.progressiveData || [];			var streaming:Array = settings.streamingData || [];						var vidData:VideoData;			var vidCtrl:Object;			var i:int;			var len:int = streaming.length >= progressive.length ? streaming.length : progressive.length;										for (i = 0; i < len; i++) {				componentInstance.getPlaylist().addVideoController(createVideoController(streaming[i], progressive[i]));			}						vidCtrl = componentInstance.getCurrentVideoController();			vidCtrl.setVideoObject(componentInstance.getVideoObject());						componentInstance.startMuted = settings.startMuted;			if (settings.autoPlay) {				if (settings.startMuted) mute();				componentInstance.getPlaylist().start(true);			}						addChild(componentInstance as DisplayObject);			addAllStudioEventListeners();						_settings = settings;		}				public function play ():void {			currentController.play();		}				public function pause ():void {			currentController.pause();		}				public function mute ():void {			componentInstance.mute();		}				public function unmute ():void {			componentInstance.unmute();		}				public function seek (sec:Number):void {			currentController.seek(sec);		}				public function skipTo (index:int):void {			removeAllStudioEventListeners();			componentInstance.skipTo(index);			addAllStudioEventListeners();		}				public function replay ():void {			currentController.replay();		}				public function next ():void {			removeAllStudioEventListeners();			componentInstance.next();			addAllStudioEventListeners();		}				public function previous ():void {			removeAllStudioEventListeners();			componentInstance.previous();			addAllStudioEventListeners();		}				public function setVolume (value:Number):void {			currentController.getAudioChannel().setVolume(value);		}				public function enterFullscreen ():void {					}				public function exitFullScreen ():void {					}				public function destroy ():void {			componentInstance.unload();		}						private function createVideoController (streaming:VideoData, progressive:VideoData = null):Object {			var enhancedVideoController:Class = StudioClassAccessor.getClass('com.google.ads.studio.video.EnhancedVideoController');			var videoEntry:Class = StudioClassAccessor.getClass('com.google.ads.studio.video.VideoEntry');						var vidCtrl:Object = new enhancedVideoController();						var vidEntry:Object;						if (streaming) {				// streaming				vidCtrl.setReportingIdentifier(streaming.id);				vidEntry = new videoEntry(streaming.low, streaming.medium, streaming.high, StudioClassAccessor.getClass('com.google.ads.studio.video.SmartStreamingConnection'));				vidCtrl.addVideoEntry(vidEntry);								// progressive fallback				if (progressive) {					vidEntry = new videoEntry(progressive.low, progressive.medium, progressive.high);					vidCtrl.addVideoEntry(vidEntry);				}			} else if (progressive) {				vidCtrl.setReportingIdentifier(progressive.id);				vidEntry = new videoEntry(progressive.low, progressive.medium, progressive.high);				vidCtrl.addVideoEntry(vidEntry);			} else {				throw new Error('VideoPlayer:: No VideoData found.');			}						return vidCtrl;		}				private function addAllStudioEventListeners ():void {						if (_hasAllStudioEventListeners) {				return;			}						var events:Array = CustomVideoEvent.getAllStudioVideoEvents();			var i:int = events.length;			while (i--) {				currentController.addEventListener(					events[i], studioVideoEventsHandler);			}						// TODO Thinking if PLAYHEAD_MOVE should be removed to free some process			//currentController.removeEventListener(//				StudioVideoEvent.PLAYHEAD_MOVE, studioVideoEventsHandler);			_hasAllStudioEventListeners = true;						trace('add all event listeners');		}				private function removeAllStudioEventListeners ():void {				if (!_hasAllStudioEventListeners) {				return;			}						var events:Array = CustomVideoEvent.getAllStudioVideoEvents();			var i:int = events.length;			while (i--) {				currentController.removeEventListener(					events[i], studioVideoEventsHandler);			}				_hasAllStudioEventListeners = false;		}				// ------------------------------ EVENT HANDLERS -----------------------------------				private function addedToStageHandler (e:Event):void {			addEventListener(Event.REMOVED_FROM_STAGE, removedFromStageHandler);			_collection.push(this);			_currentVideo = this;		}				private function removedFromStageHandler (e:Event):void {			if (!_autoDestroy) return;						removeEventListener(Event.ADDED_TO_STAGE, addedToStageHandler);			removeEventListener(Event.REMOVED_FROM_STAGE, removedFromStageHandler);						var index:int = _collection.indexOf(this);			if (index != -1)				_collection.splice(index, 1)[0];						destroy();			if (_currentVideo == this)				_currentVideo = null;		}				private function studioVideoEventsHandler (e:Object):void {			// TODO set current index			var data:VideoEventData = new VideoEventData(id, currentController.getReportingIdentifier(), 0);			var evt:CustomVideoEvent = new CustomVideoEvent(e.type, data);			var evt2:CustomVideoEvent;						switch ( e.type ) {				case 'play':					evt2 = new CustomVideoEvent(CustomVideoEvent.VIDEO_VIEW_TIMER_START, data);					dispatchEvent(evt2);					break;				case 'pause':				case 'complete':					evt2 = new CustomVideoEvent(CustomVideoEvent.VIDEO_VIEW_TIMER_STOP, data);					dispatchEvent(evt2);					// TODO if completed playlist					//dispatchEvent(new CustomVideoEvent(CustomVideoEvent.COMPLETE_ALL, data));					break;				default:			}						dispatchEvent(evt);		}	}	}